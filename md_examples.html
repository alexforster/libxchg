<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libxchg: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libxchg
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>README</span></a></li>
      <li><a href="annotated.html"><span>Documentation</span></a></li>
      <li><a href="md_examples.html"><span>Examples</span></a></li>
      <li><a href="https://github.com/alexforster/libxchg"><span>Github</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>See <a href="https://github.com/alexforster/libxchg/tree/master/examples/serialization.c"><code>examples/serialization.c</code></a> for a more complete example.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Setting up a new xchg_channel</h3>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> MESSAGE_SIZE = 64;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> RING_SIZE = 4096 + (2 * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *ring_a = malloc(RING_SIZE); <span class="comment">// pretend this is some kind of shared memory</span></div>
<div class="line"><span class="keywordtype">char</span> *ring_b = malloc(RING_SIZE);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="structxchg__channel.html">xchg_channel</a> channel = {};</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__channel.html#a946e342fed1cc50b775690a201ab6168">xchg_channel_init</a>(&amp;channel, MESSAGE_SIZE, ring_a, RING_SIZE, ring_b, RING_SIZE))</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_channel_init: %s\n&quot;</span>, <a class="code" href="structxchg__channel.html#a04683bff4f60acbb464812b26cfaac45">xchg_channel_strerror</a>(&amp;channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
Sending an xchg_message to an xchg_channel</h3>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structxchg__message.html">xchg_message</a> message = {};</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__channel.html#adadad28f66156c726bc6d7bb2af50480">xchg_channel_prepare</a>(channel, &amp;message)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_channel_prepare: %s\n&quot;</span>, <a class="code" href="structxchg__channel.html#a04683bff4f60acbb464812b26cfaac45">xchg_channel_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a3d37438172c85afb4ddc0505786b3ad1">xchg_message_write_uint16</a>(message, event-&gt;type)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_uint16: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#af02f9970b2627e95bf6a5c78ed2a1078">xchg_message_write_uint64</a>(message, event-&gt;identifier)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_uint64: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a24e0d80ec19392ad2ff2feef458ebd01">xchg_message_write_int32</a>(message, event-&gt;position_x)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_int32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a24e0d80ec19392ad2ff2feef458ebd01">xchg_message_write_int32</a>(message, event-&gt;position_y)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_int32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a1d4af8da89b6b5386e3256a65db0bfbb">xchg_message_write_float32</a>(message, event-&gt;direction)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_float32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a1d4af8da89b6b5386e3256a65db0bfbb">xchg_message_write_float32</a>(message, event-&gt;velocity)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_float32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a1d4af8da89b6b5386e3256a65db0bfbb">xchg_message_write_float32</a>(message, event-&gt;force)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_write_float32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__channel.html#a6dfa11c7f929534b889631991e5b6767">xchg_channel_send</a>(channel, &amp;message)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_channel_send: %s\n&quot;</span>, <a class="code" href="structxchg__channel.html#a04683bff4f60acbb464812b26cfaac45">xchg_channel_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md6"></a>
Receiving an xchg_message from an xchg_channel</h3>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structxchg__message.html">xchg_message</a> message = {};</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__channel.html#afd43dde9c05ecbfee26be51c42e501ae">xchg_channel_receive</a>(channel, &amp;message)) {</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint16_t event_type = 0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#af48df5a1ed49e8706419308bcd1b1b20">xchg_message_read_uint16</a>(message, &amp;event_type)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_uint16: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint64_t identifier = 0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a3507c5c787cdde3fe13e42d91ec8fc3b">xchg_message_read_uint64</a>(message, &amp;identifier)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_uint64: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int32_t position_x = 0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#ad8b444120c38d0bd0222f4323585f4e1">xchg_message_read_int32</a>(message, &amp;position_x)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_int32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int32_t position_y = 0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#ad8b444120c38d0bd0222f4323585f4e1">xchg_message_read_int32</a>(message, &amp;position_y)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_int32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">float_t direction = 0.0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a409c5ad9412a6083814db3be978e6611">xchg_message_read_float32</a>(message, &amp;direction)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_float32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">float_t velocity = 0.0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a409c5ad9412a6083814db3be978e6611">xchg_message_read_float32</a>(message, &amp;velocity)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_float32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">float_t force = 0.0;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__message.html#a409c5ad9412a6083814db3be978e6611">xchg_message_read_float32</a>(message, &amp;force)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_message_read_float32: %s\n&quot;</span>, <a class="code" href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="structxchg__channel.html#a9abde288bde842345c38be4b23bbc7ac">xchg_channel_return</a>(channel, &amp;message)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;xchg_channel_return: %s\n&quot;</span>, <a class="code" href="structxchg__channel.html#a04683bff4f60acbb464812b26cfaac45">xchg_channel_strerror</a>(channel));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="astructxchg__channel_html_afd43dde9c05ecbfee26be51c42e501ae"><div class="ttname"><a href="structxchg__channel.html#afd43dde9c05ecbfee26be51c42e501ae">xchg_channel::xchg_channel_receive</a></div><div class="ttdeci">bool xchg_channel_receive(struct xchg_channel *channel, struct xchg_message *message)</div><div class="ttdoc">Receives the next available message from channel into message, allowing the caller to read the messag...</div></div>
<div class="ttc" id="astructxchg__message_html_a24e0d80ec19392ad2ff2feef458ebd01"><div class="ttname"><a href="structxchg__message.html#a24e0d80ec19392ad2ff2feef458ebd01">xchg_message::xchg_message_write_int32</a></div><div class="ttdeci">bool xchg_message_write_int32(struct xchg_message *message, int32_t value)</div><div class="ttdoc">Writes an int32_t value to message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__message_html_a3d37438172c85afb4ddc0505786b3ad1"><div class="ttname"><a href="structxchg__message.html#a3d37438172c85afb4ddc0505786b3ad1">xchg_message::xchg_message_write_uint16</a></div><div class="ttdeci">bool xchg_message_write_uint16(struct xchg_message *message, uint16_t value)</div><div class="ttdoc">Writes a uint16_t value to message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__channel_html_a9abde288bde842345c38be4b23bbc7ac"><div class="ttname"><a href="structxchg__channel.html#a9abde288bde842345c38be4b23bbc7ac">xchg_channel::xchg_channel_return</a></div><div class="ttdeci">bool xchg_channel_return(struct xchg_channel *channel, const struct xchg_message *message)</div><div class="ttdoc">Returns the backing memory of message (previously initialized via xchg_channel_receive) to channel.</div></div>
<div class="ttc" id="astructxchg__message_html_a1d4af8da89b6b5386e3256a65db0bfbb"><div class="ttname"><a href="structxchg__message.html#a1d4af8da89b6b5386e3256a65db0bfbb">xchg_message::xchg_message_write_float32</a></div><div class="ttdeci">bool xchg_message_write_float32(struct xchg_message *message, float_t value)</div><div class="ttdoc">Writes a float32_t value to message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__message_html_ad8b444120c38d0bd0222f4323585f4e1"><div class="ttname"><a href="structxchg__message.html#ad8b444120c38d0bd0222f4323585f4e1">xchg_message::xchg_message_read_int32</a></div><div class="ttdeci">bool xchg_message_read_int32(struct xchg_message *message, int32_t *value)</div><div class="ttdoc">Reads an int32_t from message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__channel_html_a6dfa11c7f929534b889631991e5b6767"><div class="ttname"><a href="structxchg__channel.html#a6dfa11c7f929534b889631991e5b6767">xchg_channel::xchg_channel_send</a></div><div class="ttdeci">bool xchg_channel_send(struct xchg_channel *channel, const struct xchg_message *message)</div><div class="ttdoc">Sends message (previously initialized via xchg_channel_prepare) into channel.</div></div>
<div class="ttc" id="astructxchg__message_html_a1801a14ab849494c50eef1b0089de2fb"><div class="ttname"><a href="structxchg__message.html#a1801a14ab849494c50eef1b0089de2fb">xchg_message::xchg_message_strerror</a></div><div class="ttdeci">const char * xchg_message_strerror(const struct xchg_message *message)</div><div class="ttdoc">Provides a static string describing the error that occurred during the last operation on message.</div></div>
<div class="ttc" id="astructxchg__message_html"><div class="ttname"><a href="structxchg__message.html">xchg_message</a></div><div class="ttdoc">Represents a stream of values that can be encoded and decoded using the xchg_message_* family of func...</div><div class="ttdef"><b>Definition:</b> xchg.h:51</div></div>
<div class="ttc" id="astructxchg__message_html_a409c5ad9412a6083814db3be978e6611"><div class="ttname"><a href="structxchg__message.html#a409c5ad9412a6083814db3be978e6611">xchg_message::xchg_message_read_float32</a></div><div class="ttdeci">bool xchg_message_read_float32(struct xchg_message *message, float_t *value)</div><div class="ttdoc">Reads a float32_t from message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__message_html_af02f9970b2627e95bf6a5c78ed2a1078"><div class="ttname"><a href="structxchg__message.html#af02f9970b2627e95bf6a5c78ed2a1078">xchg_message::xchg_message_write_uint64</a></div><div class="ttdeci">bool xchg_message_write_uint64(struct xchg_message *message, uint64_t value)</div><div class="ttdoc">Writes a uint64_t value to message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__channel_html"><div class="ttname"><a href="structxchg__channel.html">xchg_channel</a></div><div class="ttdoc">Represents a lock-free communication device backed by shared memory buffers which can be manipulated ...</div><div class="ttdef"><b>Definition:</b> xchg.h:797</div></div>
<div class="ttc" id="astructxchg__channel_html_adadad28f66156c726bc6d7bb2af50480"><div class="ttname"><a href="structxchg__channel.html#adadad28f66156c726bc6d7bb2af50480">xchg_channel::xchg_channel_prepare</a></div><div class="ttdeci">bool xchg_channel_prepare(struct xchg_channel *channel, struct xchg_message *message)</div><div class="ttdoc">Prepares message with writable backing memory from channel, allowing the caller to construct a messag...</div></div>
<div class="ttc" id="astructxchg__channel_html_a04683bff4f60acbb464812b26cfaac45"><div class="ttname"><a href="structxchg__channel.html#a04683bff4f60acbb464812b26cfaac45">xchg_channel::xchg_channel_strerror</a></div><div class="ttdeci">const char * xchg_channel_strerror(const struct xchg_channel *channel)</div><div class="ttdoc">Provides a static string describing the error that occurred during the last operation on channel</div></div>
<div class="ttc" id="astructxchg__message_html_af48df5a1ed49e8706419308bcd1b1b20"><div class="ttname"><a href="structxchg__message.html#af48df5a1ed49e8706419308bcd1b1b20">xchg_message::xchg_message_read_uint16</a></div><div class="ttdeci">bool xchg_message_read_uint16(struct xchg_message *message, uint16_t *value)</div><div class="ttdoc">Reads a uint16_t from message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__message_html_a3507c5c787cdde3fe13e42d91ec8fc3b"><div class="ttname"><a href="structxchg__message.html#a3507c5c787cdde3fe13e42d91ec8fc3b">xchg_message::xchg_message_read_uint64</a></div><div class="ttdeci">bool xchg_message_read_uint64(struct xchg_message *message, uint64_t *value)</div><div class="ttdoc">Reads a uint64_t from message and advances the underlying buffer position.</div></div>
<div class="ttc" id="astructxchg__channel_html_a946e342fed1cc50b775690a201ab6168"><div class="ttname"><a href="structxchg__channel.html#a946e342fed1cc50b775690a201ab6168">xchg_channel::xchg_channel_init</a></div><div class="ttdeci">bool xchg_channel_init(struct xchg_channel *channel, size_t sz_message, char *ingress, size_t sz_ingress, char *egress, size_t sz_egress)</div><div class="ttdoc">Configures channel to use ingress of size sz_ingress and egress of size sz_egress as underlying share...</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
